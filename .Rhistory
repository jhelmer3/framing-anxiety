#| message: false
#| code-fold: show
library(tidyverse)
#| message: false
#| code-fold: show
dat_full <- qualtRics::read_survey(here::here("..", "Data", "prolific_2026.01.14.csv")) |>
mutate(id = row_number(),
.keep = "unused")
#| message: false
#| code-fold: show
dat_full <- qualtRics::read_survey(here::here("..", "Data", "prolific_2026.01.14.csv")) |>
mutate(id = row_number(),
.keep = "unused") |>
filter(Progress == 100)
#| message: false
#| code-fold: show
library(tidyverse)
#| message: false
#| code-fold: show
dat_full <- qualtRics::read_survey(here::here("..", "Data", "prolific_2026.01.14.csv")) |>
mutate(id = row_number(),
.keep = "unused") |>
filter(Progress == 100)
dat <- dat_full |>
select(id, matches("^[F][GL][PV]_[0-9\\.-]+$")) |>
pivot_longer(!id,
names_to = "item", values_to = "response") |>
filter(!is.na(response)) |>
separate_wider_regex(item, c(cond = "[F][GL][PV]", "_", rest = ".*")) |>
separate_wider_regex(rest, c(fixed = "^\\d*", "-*", rest = ".*")) |>
separate_wider_delim(rest, "-", names = c("varied"), too_few = "align_end") |>
separate_wider_position(cond, c(1, "frame" = 1, "target" = 1)) |>
mutate(.by = c(frame, target, fixed),
item = cur_group_id(),
.after = id) |>
mutate(.by = c(item, id),
trial = 1:n(),
.after = id) |>
mutate(varied = as.numeric(varied),
fixed = as.numeric(fixed),
lottery = ifelse(target == "P", varied, fixed),
certain = ifelse(target == "V", varied, fixed),
lottery_std = (lottery - mean(lottery)) / sd(lottery),
certain_std = (certain - mean(certain)) / sd(lottery),
# if matches the fixed dollar option, 0, else 1 (for risky)
chose_risky = ifelse(str_detect(response, "Keep \\$[0-9]+") |
str_detect(response, "Forfeit \\$[0-9]+"), 0, 1)) |>
left_join(dat_full |>
select(id, starts_with("IUS") & !matches("IUS_T")) |>
pivot_longer(!id, names_to = "item", values_to = "response") |>
mutate(response = case_when(response == "Entirely characteristic of me" ~ 5,
response == "Very characteristic of me" ~ 4,
response == "Somewhat characteristic of me" ~ 3,
response == "A little characteristic of me" ~ 2,
response == "Not at all characteristic of me" ~ 1)) |>
summarize(.by = id,
IUS = mean(response)),
by = "id") |>
mutate(ev_varied = ifelse(frame == "L", 100 - varied, varied),
ev_fixed = ifelse(frame == "L", 100 - fixed, fixed),
lottery_certain_diff = lottery_std - certain_std,
across(c(IUS, lottery_certain_diff), ~ (.x - mean(.x)) / sd(.x),
.names = "{.col}_z"))
m0 <- lme4::glmer(chose_risky ~ 1 + (1 | item) + (1 | id),
dat, family = "binomial")
sjPlot::tab_model(m0)
m1 <- lme4::glmer(chose_risky ~ IUS * lottery_certain_diff * frame + (1 | item) + (1 | id),
dat, family = "binomial")
sjPlot::tab_model(m1)
names(dat)
names(dat_full)
dat_full |>
select(id, starts_with("BIS/BAS") & !matches("BISBAS_T"))
dat <- dat_full |>
select(id, matches("^[F][GL][PV]_[0-9\\.-]+$")) |>
pivot_longer(!id,
names_to = "item", values_to = "response") |>
filter(!is.na(response)) |>
separate_wider_regex(item, c(cond = "[F][GL][PV]", "_", rest = ".*")) |>
separate_wider_regex(rest, c(fixed = "^\\d*", "-*", rest = ".*")) |>
separate_wider_delim(rest, "-", names = c("varied"), too_few = "align_end") |>
separate_wider_position(cond, c(1, "frame" = 1, "target" = 1)) |>
mutate(.by = c(frame, target, fixed),
item = cur_group_id(),
.after = id) |>
mutate(.by = c(item, id),
trial = 1:n(),
.after = id) |>
mutate(varied = as.numeric(varied),
fixed = as.numeric(fixed),
lottery = ifelse(target == "P", varied, fixed),
certain = ifelse(target == "V", varied, fixed),
lottery_std = (lottery - mean(lottery)) / sd(lottery),
certain_std = (certain - mean(certain)) / sd(lottery),
# if matches the fixed dollar option, 0, else 1 (for risky)
chose_risky = ifelse(str_detect(response, "Keep \\$[0-9]+") |
str_detect(response, "Forfeit \\$[0-9]+"), 0, 1)) |>
left_join(dat_full |>
select(id, starts_with("IUS") & !matches("IUS_T")) |>
pivot_longer(!id, names_to = "item", values_to = "response") |>
mutate(response = case_when(response == "Entirely characteristic of me" ~ 5,
response == "Very characteristic of me" ~ 4,
response == "Somewhat characteristic of me" ~ 3,
response == "A little characteristic of me" ~ 2,
response == "Not at all characteristic of me" ~ 1)) |>
summarize(.by = id,
IUS = mean(response)),
by = "id") |>
left_join(dat_full |>
select(id, starts_with("BIS/BAS") & !matches("BISBAS_T")) |>
pivot_longer(!id, names_to = "item", values_to = "response") |>
mutate(response = case_when(response == "Very true for me" ~ 4,
response == "Somewhat true for me" ~ 3,
response == "Somewhat false for me" ~ 2,
response == "Very false for me" ~ 1)) |>
summarize(.by = id,
BIS_BAS = mean(response)),
by = "id") |>
mutate(ev_varied = ifelse(frame == "L", 100 - varied, varied),
ev_fixed = ifelse(frame == "L", 100 - fixed, fixed),
lottery_certain_diff = lottery_std - certain_std,
across(c(IUS, BIS_BAS), ~ (.x - mean(.x)) / sd(.x),
.names = "{.col}_z"))
View(dat)
dat_full |>
select(id, starts_with("STAI-T") & !matches("STAI-T_T"))
dat_full$`STAI-T_01_1` |> unique()
dat <- dat_full |>
select(id, matches("^[F][GL][PV]_[0-9\\.-]+$")) |>
pivot_longer(!id,
names_to = "item", values_to = "response") |>
filter(!is.na(response)) |>
separate_wider_regex(item, c(cond = "[F][GL][PV]", "_", rest = ".*")) |>
separate_wider_regex(rest, c(fixed = "^\\d*", "-*", rest = ".*")) |>
separate_wider_delim(rest, "-", names = c("varied"), too_few = "align_end") |>
separate_wider_position(cond, c(1, "frame" = 1, "target" = 1)) |>
mutate(.by = c(frame, target, fixed),
item = cur_group_id(),
.after = id) |>
mutate(.by = c(item, id),
trial = 1:n(),
.after = id) |>
mutate(varied = as.numeric(varied),
fixed = as.numeric(fixed),
lottery = ifelse(target == "P", varied, fixed),
certain = ifelse(target == "V", varied, fixed),
lottery_std = (lottery - mean(lottery)) / sd(lottery),
certain_std = (certain - mean(certain)) / sd(lottery),
# if matches the fixed dollar option, 0, else 1 (for risky)
chose_risky = ifelse(str_detect(response, "Keep \\$[0-9]+") |
str_detect(response, "Forfeit \\$[0-9]+"), 0, 1)) |>
left_join(dat_full |>
select(id, starts_with("IUS") & !matches("IUS_T")) |>
pivot_longer(!id, names_to = "item", values_to = "response") |>
mutate(response = case_when(response == "Entirely characteristic of me" ~ 5,
response == "Very characteristic of me" ~ 4,
response == "Somewhat characteristic of me" ~ 3,
response == "A little characteristic of me" ~ 2,
response == "Not at all characteristic of me" ~ 1)) |>
summarize(.by = id,
IUS = mean(response)),
by = "id") |>
left_join(dat_full |>
select(id, starts_with("BIS/BAS") & !matches("BISBAS_T")) |>
pivot_longer(!id, names_to = "item", values_to = "response") |>
mutate(response = case_when(response == "Very true for me" ~ 4,
response == "Somewhat true for me" ~ 3,
response == "Somewhat false for me" ~ 2,
response == "Very false for me" ~ 1)) |>
summarize(.by = id,
BIS_BAS = mean(response)),
by = "id") |>
left_join(dat_full |>
select(id, starts_with("STAI-T") & !matches("STAI-T_T")) |>
pivot_longer(!id, names_to = "item", values_to = "response") |>
# double check these codings
mutate(response = case_when(response == "Almost never" ~ 4,
response == "Often" ~ 3,
response == "Sometimes" ~ 2,
response == "Almost always" ~ 1)) |>
summarize(.by = id,
STAI_T = mean(response)),
by = "id") |>
mutate(ev_varied = ifelse(frame == "L", 100 - varied, varied),
ev_fixed = ifelse(frame == "L", 100 - fixed, fixed),
lottery_certain_diff = lottery_std - certain_std,
across(c(IUS, BIS_BAS, STAI_T), ~ (.x - mean(.x)) / sd(.x),
.names = "{.col}_z"))
m1.0 <- lme4::glmer(chose_risky ~ IUS + BIS_BAS, STAI_T + lottery_certain_diff + frame +
(1 | item) + (1 | id),
dat, family = "binomial")
m1.0 <- lme4::glmer(chose_risky ~ IUS + BIS_BAS + STAI_T + lottery_certain_diff + frame +
(1 | item) + (1 | id),
dat, family = "binomial")
m1.0 <- lme4::glmer(chose_risky ~ IUS + BIS_BAS + STAI_T + lottery_certain_diff + frame +
(1 | item) + (1 | id),
dat, family = "binomial",
lme4::lmerControl(optimizer = "bobyqa"))
sjPlot::tab_model(m1.0)
m1.1 <- lme4::glmer(chose_risky ~ IUS * BIS_BAS * STAI_T * lottery_certain_diff * frame +
(1 | item) + (1 | id),
dat, family = "binomial",
lme4::glmerControl(optimizer = "bobyqa"))
m1.1 <- lme4::glmer(chose_risky ~ IUS + BIS_BAS + STAI_T + lottery_certain_diff + frame +
IUS:frame + BIS_BAS:frame + STAI_T:frame + lottery_certain_diff:frame +
IUS:lottery_certain_diff + BIS_BAS:lottery_certain_diff + STAI_T:lottery_certain_diff +
(1 | item) + (1 | id),
dat, family = "binomial",
lme4::glmerControl(optimizer = "bobyqa"))
saveRDS(here::here("Models", "risky-choice_1.1.rds"))
saveRDS(m1.1, here::here("Models", "risky-choice_1.1.rds"))
file.exists(here::here("Models"))
if file.exists(here::here("Models"))
if (file.exists(here::here("Models")))
if (file.exists(here::here("Models"))) print("Hurrah")
if (!file.exists(here::here("Models"))) dir.create(here::here("Models"))
saveRDS(m1.1, here::here("Models", "risky-choice_1.1.rds"))
saveRDS(m1.1, here::here("Models", "risky-choice_1.1.rds"))
saveRDS(m1.0, here::here("Models", "risky-choice_1.0.rds"))
saveRDS(m0, here::here("Models", "risky-choice_0.rds"))
m1.1 |>
ggeffects::ggpredict(terms = c("IUS", "frame")) |>
plot() +
theme_classic()
m1.1 |>
ggeffects::ggpredict(terms = c("IUS[all]", "frame")) |>
plot() +
theme_classic()
sjPlot::tab_model(m1.1)
m0 <- lme4::glmer(chose_risky ~ 1 + (1 | item) + (1 | id),
dat, family = "binomial")
saveRDS(m0, here::here("Models", "risky-choice_0.rds"))
m1.0 <- lme4::glmer(chose_risky ~ IUS_z + BIS_BAS_z + STAI_T_z + lottery_certain_diff + frame +
(1 | item) + (1 | id),
dat, family = "binomial",
lme4::glmerControl(optimizer = "bobyqa"))
saveRDS(m1.0, here::here("Models", "risky-choice_1.0.rds"))
m1.1 <- lme4::glmer(chose_risky ~ IUS_z + BIS_BAS_z + STAI_T_z + lottery_certain_diff + frame +
IUS_z:frame + BIS_BAS_z:frame + STAI_T_z:frame + lottery_certain_diff:frame +
IUS_z:lottery_certain_diff + BIS_BAS_z:lottery_certain_diff + STAI_T_z:lottery_certain_diff +
(1 | item) + (1 | id),
dat, family = "binomial",
lme4::glmerControl(optimizer = "bobyqa"))
saveRDS(m1.1, here::here("Models", "risky-choice_1.1.rds"))
#| layout-ncol: 3
m0 <- readRDS(here::here("Models", "risky-choice_0.rds"))
m1.0 <- readRDS(here::here("Models", "risky-choice_1.0.rds"))
m1.1 <- readRDS(here::here("Models", "risky-choice_1.1.rds"))
sjPlot::tab_model(m0)
sjPlot::tab_model(m1.0)
sjPlot::tab_model(m1.1)
m1.1 |>
ggeffects::ggpredict(terms = c("IUS[all]", "frame")) |>
plot() +
theme_classic()
m1.1 |>
ggeffects::ggpredict(terms = c("IUS_z[all]", "frame")) |>
plot() +
theme_classic()
m1.1 |>
ggeffects::ggpredict(terms = c("STAI_T_z[all]", "frame")) |>
plot() +
theme_classic()
m1.1 |>
ggeffects::ggpredict(terms = c("lottery_certain_diff", "frame")) |>
plot() +
theme_classic()
m1.1 |>
ggeffects::ggpredict(terms = c("lottery_certain_diff[all]", "frame")) |>
plot() +
theme_classic()
#| layout-ncol: 3
m0 <- readRDS(here::here("Models", "risky-choice_0.rds"))
sjPlot::tab_model(m0,
show.ci = F,
show.se = T)
?sjPlot::tab_model
sjPlot::tab_model(m0,
show.ci = F,
show.se = T,
string.se = "SE")
sjPlot::tab_model(m0,
show.ci = F,
show.se = T,
string.se = "SE",
show.r2 = F,
string.resp = "FFF")
sjPlot::tab_model(m0,
show.ci = F,
show.se = T,
string.se = "SE",
show.r2 = F,
title = "Hello")
sjPlot::tab_model(m0,
show.ci = F,
show.se = T,
string.se = "SE",
show.r2 = F,
title = "Hello",
dv.labels = "")
sjPlot::tab_model(m0,
show.ci = F,
show.se = T,
string.se = "SE",
show.r2 = F,
dv.labels = "")
walk(c(m0, m1.0, m1.1),
~ tab_model(.x,
show.ci = F,
show.se = T,
string.se = "SE",
show.r2 = F,
dv.labels = ""))
library(purrr)
walk(c(m0, m1.0, m1.1),
~ tab_model(.x,
show.ci = F,
show.se = T,
string.se = "SE",
show.r2 = F,
dv.labels = ""))
#| layout-ncol: 3
m0 <- readRDS(here::here("Models", "risky-choice_0.rds"))
m1.0 <- readRDS(here::here("Models", "risky-choice_1.0.rds"))
m1.1 <- readRDS(here::here("Models", "risky-choice_1.1.rds"))
walk(c(m0, m1.0, m1.1),
~ tab_model(.x,
show.ci = F,
show.se = T,
string.se = "SE",
show.r2 = F,
dv.labels = ""))
#| layout-ncol: 3
m0 <- readRDS(here::here("Models", "risky-choice_0.rds"))
m1.0 <- readRDS(here::here("Models", "risky-choice_1.0.rds"))
m1.1 <- readRDS(here::here("Models", "risky-choice_1.1.rds"))
walk(c(m0, m1.0, m1.1),
~ sjPlot::tab_model(.x,
show.ci = F,
show.se = T,
string.se = "SE",
show.r2 = F,
dv.labels = ""))
map(c(m0, m1.0, m1.1),
~ sjPlot::tab_model(.x,
show.ci = F,
show.se = T,
string.se = "SE",
show.r2 = F,
dv.labels = ""))
walk(c(m0, m1.0, m1.1),
~ sjPlot::tab_model(.x,
show.ci = F,
show.se = T,
string.se = "SE",
show.r2 = F,
dv.labels = "") |>
View())
walk(c(m0, m1.0, m1.1),
~ sjPlot::tab_model(.x,
show.ci = F,
show.se = T,
string.se = "SE",
show.r2 = F,
dv.labels = "") |>
print())
